<div class="flex-1 min-h-0 overflow-auto w-full h-full">
  @if (loading()) {
    <p class="px-4 py-2 text-sm text-gray-400">Loading cryptocurrencies...</p>
  } @else if (error()) {
    <p class="px-4 py-2 text-sm text-red-400">
      {{ error() }}
    </p>
  } @else {
    <table class="min-w-full w-full table-auto border-collapse">
      <thead class="sticky top-0 bg-black/70">
        <tr>
          <th
            class="px-4 py-2 text-left max-w-[120px] cursor-pointer hover:bg-white/10 transition-colors"
            (click)="sortBy('id')"
          >
            <div class="flex items-center gap-1">
              <span>ID</span>
              <div class="w-3 h-3 flex items-center justify-center">
                @if (isSortedBy('id')) {
                  @if (getSortDirection('id') === 'asc') {
                    <i-lucide [img]="arrowUpIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  } @else {
                    <i-lucide [img]="arrowDownIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  }
                }
              </div>
            </div>
          </th>
          <th
            class="px-4 py-2 text-left max-w-[150px] cursor-pointer hover:bg-white/10 transition-colors"
            (click)="sortBy('name')"
          >
            <div class="flex items-center gap-1">
              <span>Name</span>
              <div class="w-3 h-3 flex items-center justify-center">
                @if (isSortedBy('name')) {
                  @if (getSortDirection('name') === 'asc') {
                    <i-lucide [img]="arrowUpIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  } @else {
                    <i-lucide [img]="arrowDownIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  }
                }
              </div>
            </div>
          </th>
          <th
            class="px-4 py-2 text-left whitespace-nowrap cursor-pointer hover:bg-white/10 transition-colors"
            (click)="sortBy('symbol')"
          >
            <div class="flex items-center gap-1">
              <span>Symbol</span>
              <div class="w-3 h-3 flex items-center justify-center">
                @if (isSortedBy('symbol')) {
                  @if (getSortDirection('symbol') === 'asc') {
                    <i-lucide [img]="arrowUpIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  } @else {
                    <i-lucide [img]="arrowDownIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  }
                }
              </div>
            </div>
          </th>
          <th
            class="px-4 py-2 text-right whitespace-nowrap cursor-pointer hover:bg-white/10 transition-colors"
            (click)="sortBy('current_price')"
          >
            <div class="flex items-center justify-end gap-1">
              <div class="w-3 h-3 flex items-center justify-center">
                @if (isSortedBy('current_price')) {
                  @if (getSortDirection('current_price') === 'asc') {
                    <i-lucide [img]="arrowUpIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  } @else {
                    <i-lucide [img]="arrowDownIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  }
                }
              </div>
              <span>Price (USD)</span>
            </div>
          </th>
          <th
            class="px-4 py-2 text-right whitespace-nowrap cursor-pointer hover:bg-white/10 transition-colors"
            (click)="sortBy('market_cap')"
          >
            <div class="flex items-center justify-end gap-1">
              <div class="w-3 h-3 flex items-center justify-center">
                @if (isSortedBy('market_cap')) {
                  @if (getSortDirection('market_cap') === 'asc') {
                    <i-lucide [img]="arrowUpIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  } @else {
                    <i-lucide [img]="arrowDownIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  }
                }
              </div>
              <span>Market Cap</span>
            </div>
          </th>
          <th
            class="px-4 py-2 text-right whitespace-nowrap cursor-pointer hover:bg-white/10 transition-colors"
            (click)="sortBy('total_volume')"
          >
            <div class="flex items-center justify-end gap-1">
              <div class="w-3 h-3 flex items-center justify-center">
                @if (isSortedBy('total_volume')) {
                  @if (getSortDirection('total_volume') === 'asc') {
                    <i-lucide [img]="arrowUpIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  } @else {
                    <i-lucide [img]="arrowDownIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  }
                }
              </div>
              <span>Total Volume</span>
            </div>
          </th>
          <th
            class="px-4 py-2 text-right whitespace-nowrap cursor-pointer hover:bg-white/10 transition-colors"
            (click)="sortBy('high_24h')"
          >
            <div class="flex items-center justify-end gap-1">
              <div class="w-3 h-3 flex items-center justify-center">
                @if (isSortedBy('high_24h')) {
                  @if (getSortDirection('high_24h') === 'asc') {
                    <i-lucide [img]="arrowUpIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  } @else {
                    <i-lucide [img]="arrowDownIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  }
                }
              </div>
              <span>High 24h</span>
            </div>
          </th>
          <th
            class="px-4 py-2 text-right whitespace-nowrap cursor-pointer hover:bg-white/10 transition-colors"
            (click)="sortBy('low_24h')"
          >
            <div class="flex items-center justify-end gap-1">
              <div class="w-3 h-3 flex items-center justify-center">
                @if (isSortedBy('low_24h')) {
                  @if (getSortDirection('low_24h') === 'asc') {
                    <i-lucide [img]="arrowUpIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  } @else {
                    <i-lucide [img]="arrowDownIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  }
                }
              </div>
              <span>Low 24h</span>
            </div>
          </th>
          <th
            class="px-4 py-2 text-right whitespace-nowrap cursor-pointer hover:bg-white/10 transition-colors"
            (click)="sortBy('price_change_percentage_24h')"
          >
            <div class="flex items-center justify-end gap-1">
              <div class="w-3 h-3 flex items-center justify-center">
                @if (isSortedBy('price_change_percentage_24h')) {
                  @if (getSortDirection('price_change_percentage_24h') === 'asc') {
                    <i-lucide [img]="arrowUpIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  } @else {
                    <i-lucide [img]="arrowDownIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  }
                }
              </div>
              <span>Price Change % (24h)</span>
            </div>
          </th>
          <th
            class="px-4 py-2 text-right whitespace-nowrap cursor-pointer hover:bg-white/10 transition-colors"
            (click)="sortBy('circulating_supply')"
          >
            <div class="flex items-center justify-end gap-1">
              <div class="w-3 h-3 flex items-center justify-center">
                @if (isSortedBy('circulating_supply')) {
                  @if (getSortDirection('circulating_supply') === 'asc') {
                    <i-lucide [img]="arrowUpIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  } @else {
                    <i-lucide [img]="arrowDownIcon" class="w-3 h-3 text-white/80"></i-lucide>
                  }
                }
              </div>
              <span>Circulating Supply</span>
            </div>
          </th>
        </tr>
      </thead>

      <tbody>
        @for (crypto of cryptos(); track crypto.id; let i = $index) {
          <tr
            class="border-t border-white/10 transition-colors hover:bg-white/15"
            [class.bg-white/5]="i % 2 === 0"
            [class.bg-white/10]="i % 2 !== 0"
          >
            <td class="px-4 py-2 max-w-[120px]" [title]="crypto.id">
              <div class="truncate-cell" [title]="crypto.id">
                {{ crypto.id }}
              </div>
            </td>
            <td class="px-4 py-2 max-w-[150px]" [title]="crypto.name">
              <div class="truncate-cell" [title]="crypto.name">
                {{ crypto.name }}
              </div>
            </td>
            <td class="px-4 py-2 whitespace-nowrap">{{ crypto.symbol | uppercase }}</td>
            <td class="px-4 py-2 text-right whitespace-nowrap">
              <app-formatted-price [value]="crypto.current_price" />
            </td>
            <td class="px-4 py-2 text-right whitespace-nowrap">
              {{
                crypto.market_cap !== null && crypto.market_cap !== undefined
                  ? (crypto.market_cap | number)
                  : '-'
              }}
            </td>
            <td class="px-4 py-2 text-right whitespace-nowrap">
              {{
                crypto.total_volume !== null && crypto.total_volume !== undefined
                  ? (crypto.total_volume | number)
                  : '-'
              }}
            </td>
            <td class="px-4 py-2 text-right whitespace-nowrap">
              <app-formatted-price [value]="crypto.high_24h" />
            </td>
            <td class="px-4 py-2 text-right whitespace-nowrap">
              <app-formatted-price [value]="crypto.low_24h" />
            </td>
            <td class="px-4 py-2 text-right whitespace-nowrap">
              {{
                crypto.price_change_percentage_24h !== null &&
                crypto.price_change_percentage_24h !== undefined
                  ? (crypto.price_change_percentage_24h | number: '1.2-2')
                  : '-'
              }}
            </td>
            <td class="px-4 py-2 text-right whitespace-nowrap">
              {{
                crypto.circulating_supply !== null && crypto.circulating_supply !== undefined
                  ? (crypto.circulating_supply | number)
                  : '-'
              }}
            </td>
          </tr>
        }
      </tbody>
    </table>
  }
</div>
