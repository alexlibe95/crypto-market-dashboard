<div class="flex-1 min-h-0 overflow-auto w-full h-full">
  @if (loading()) {
    <p class="px-4 py-2 text-sm text-gray-400">Loading cryptocurrencies...</p>
  } @else if (error()) {
    <p class="px-4 py-2 text-sm text-red-400">
      {{ error() }}
    </p>
  } @else {
    <table class="min-w-full w-full table-auto border-collapse">
      <thead class="sticky top-0 bg-black/70">
        <tr>
          <th class="px-4 py-2 text-left max-w-[120px]">ID</th>
          <th class="px-4 py-2 text-left max-w-[150px]">Name</th>
          <th class="px-4 py-2 text-left whitespace-nowrap">Symbol</th>
          <th class="px-4 py-2 text-right whitespace-nowrap">Price (USD)</th>
          <th class="px-4 py-2 text-right whitespace-nowrap">Market Cap</th>
          <th class="px-4 py-2 text-right whitespace-nowrap">Total Volume</th>
          <th class="px-4 py-2 text-right whitespace-nowrap">High 24h</th>
          <th class="px-4 py-2 text-right whitespace-nowrap">Low 24h</th>
          <th class="px-4 py-2 text-right whitespace-nowrap">Price Change % (24h)</th>
          <th class="px-4 py-2 text-right whitespace-nowrap">Circulating Supply</th>
        </tr>
      </thead>

      <tbody>
        @for (crypto of cryptos(); track crypto.id; let i = $index) {
          <tr
            class="border-t border-white/10 transition-colors hover:bg-white/15"
            [class.bg-white/5]="i % 2 === 0"
            [class.bg-white/10]="i % 2 !== 0"
          >
            <td class="px-4 py-2 max-w-[120px]" [title]="crypto.id">
              <div class="truncate-cell" [title]="crypto.id">
                {{ crypto.id }}
              </div>
            </td>
            <td class="px-4 py-2 max-w-[150px]" [title]="crypto.name">
              <div class="truncate-cell" [title]="crypto.name">
                {{ crypto.name }}
              </div>
            </td>
            <td class="px-4 py-2 whitespace-nowrap">{{ crypto.symbol | uppercase }}</td>
            <td class="px-4 py-2 text-right whitespace-nowrap">
              @if (!crypto.current_price) {
                -
              } @else if (crypto.current_price >= 0.01) {
                {{ crypto.current_price | number: '1.2-2' }}
              } @else {
                @let formatted =
                  formatSmallNumber(crypto.current_price) ?? { zeroCount: 0, significant: '-' };
                <span>
                  0.0
                  <sup class="text-xs opacity-90">
                    {{ formatted.zeroCount }}
                  </sup>
                  {{ formatted.significant }}
                </span>
              }
            </td>
            <td class="px-4 py-2 text-right whitespace-nowrap">
              {{ crypto.market_cap ? (crypto.market_cap | number) : '-' }}
            </td>
            <td class="px-4 py-2 text-right whitespace-nowrap">
              {{ crypto.total_volume ? (crypto.total_volume | number) : '-' }}
            </td>
            <td class="px-4 py-2 text-right whitespace-nowrap">
              @if (!crypto.high_24h) {
                -
              } @else if (crypto.high_24h >= 0.01) {
                {{ crypto.high_24h | number: '1.2-2' }}
              } @else {
                @let formatted =
                  formatSmallNumber(crypto.high_24h) ?? { zeroCount: 0, significant: '-' };
                <span>
                  0.0
                  <sup class="text-xs opacity-90">
                    {{ formatted.zeroCount }}
                  </sup>
                  {{ formatted.significant }}
                </span>
              }
            </td>
            <td class="px-4 py-2 text-right whitespace-nowrap">
              @if (!crypto.low_24h) {
                -
              } @else if (crypto.low_24h >= 0.01) {
                {{ crypto.low_24h | number: '1.2-2' }}
              } @else {
                @let formatted =
                  formatSmallNumber(crypto.low_24h) ?? { zeroCount: 0, significant: '-' };
                <span>
                  0.0
                  <sup class="text-xs opacity-90">
                    {{ formatted.zeroCount }}
                  </sup>
                  {{ formatted.significant }}
                </span>
              }
            </td>
            <td class="px-4 py-2 text-right whitespace-nowrap">
              {{
                crypto.price_change_percentage_24h
                  ? (crypto.price_change_percentage_24h | number: '1.2-2')
                  : '-'
              }}
            </td>
            <td class="px-4 py-2 text-right whitespace-nowrap">
              {{ crypto.circulating_supply ? (crypto.circulating_supply | number) : '-' }}
            </td>
          </tr>
        }
      </tbody>
    </table>
  }
</div>
